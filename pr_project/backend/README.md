# TestOps Copilot Backend (Прототип)

## Обзор Проекта

Этот репозиторий содержит прототип бэкенд-сервиса для TestOps Copilot, разработанный для автоматической генерации тестового кода (UI и API) на основе спецификаций OpenAPI и текстовых требований, с использованием большой языковой модели (LLM) и интеграцией с GitLab.

Проект реализован на **Python** с использованием фреймворка **FastAPI** для предоставления RESTful API.

## Задачи, Выполненные в рамках Дней 1-4 (Бэкенд)

В рамках плана разработки были выполнены следующие задачи:

| Задача | Описание | Статус |
| :--- | :--- | :--- |
| **1** | Экстренная настройка LLM (клиент) | ✅ Завершена (`llm_client.py` с заглушкой и fallback-логикой) |
| **2** | Генератор тест-кейсов (шаблоны) | ✅ Завершена (Jinja2 шаблоны `ui_test_template.j2`, `api_test_template.j2`) |
| **3** | Интеграция с GitLab | ✅ Завершена (`gitlab_client.py` с функцией коммита) |
| **5** | FastAPI бэкенд | ✅ Завершена (`app.py` с основными эндпоинтами) |
| **6** | Докеризация и развёртывание | ✅ Завершена (`Dockerfile`, `docker-compose.yml`) |
| **8** | Улучшение качества (Логирование, Ошибки, Кэширование) | ✅ Завершена (Логирование, обработка ошибок, `lru_cache` для LLM) |

## Запуск Проекта

### 1. Запуск через Docker (Рекомендуется)

Это самый простой и надежный способ запуска, так как он автоматически устанавливает все зависимости.

1.  Перейдите в директорию `Cloud2`.
2.  Создайте файл `.env` для хранения переменных окружения (или экспортируйте их):
    ```bash
    # .env file
    CLOUD_RU_API_KEY="YOUR_LLM_API_KEY_HERE"
    GITLAB_TOKEN="YOUR_GITLAB_TOKEN_HERE"
    ```
3.  Соберите и запустите контейнер:
    ```bash
    docker-compose up --build
    ```
4.  Сервис будет доступен по адресу: `http://localhost:8000`

### 2. Локальный запуск

1.  Установите зависимости:
    ```bash
    pip install -r requirements.txt
    ```
2.  Установите переменные окружения (замените на ваши реальные ключи):
    ```bash
    export CLOUD_RU_API_KEY="YOUR_LLM_API_KEY_HERE"
    export GITLAB_TOKEN="YOUR_GITLAB_TOKEN_HERE"
    ```
3.  Запустите сервер Uvicorn:
    ```bash
    uvicorn app:app --host 0.0.0.0 --port 8000 --reload
    ```
4.  Сервис будет доступен по адресу: `http://localhost:8000`

## API Эндпоинты (FastAPI)

После запуска, полная интерактивная документация доступна по адресу: `http://localhost:8000/docs` (Swagger UI).

| Метод | Путь | Описание |
| :--- | :--- | :--- |
| `POST` | `/generate/api` | **Генерация API тестов.** Принимает файл OpenAPI спецификации и возвращает сгенерированный тестовый код. |
| `POST` | `/generate/ui` | **Генерация UI тестов.** Принимает текстовые требования (`requirements`) и возвращает сгенерированный тестовый код. |
| `POST` | `/commit` | **Коммит в GitLab.** Принимает сгенерированный код, URL репозитория и имя файла для коммита. |
| `GET` | `/health` | Проверка состояния сервиса. |

## Структура Проекта

```
Cloud2/
├── app.py                  # Основное FastAPI приложение (Задача 5, 8)
├── Dockerfile              # Инструкции для сборки Docker-образа (Задача 6)
├── docker-compose.yml      # Конфигурация для запуска в Docker (Задача 6)
├── requirements.txt        # Список зависимостей
├── README.md               # Этот файл (Задача 9)
├── generator.py            # Логика генерации тестов (обновлен для Jinja2)
├── parser.py               # Логика парсинга OpenAPI
├── validator.py            # Логика валидации тестового кода
├── llm_client.py           # Клиент LLM с заглушкой и fallback (Задача 1)
├── gitlab_client.py        # Клиент GitLab с функцией коммита (Задача 3)
├── templates/              # Директория с Jinja2 шаблонами (Задача 2)
│   ├── api_test_template.j2
│   └── ui_test_template.j2
├── main.py                 # Устаревший CLI (перенаправляет на app.py)
└── ... (другие файлы)
```
