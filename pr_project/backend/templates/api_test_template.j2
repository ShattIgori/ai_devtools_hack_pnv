import allure
import pytest
import requests

@allure.feature("API Compute VMs")
@allure.story("{{ story_name }}")
class Test{{ ClassName }}:
    """
    Тест-кейс для API Compute VMs.
    Сгенерирован на основе OpenAPI операции: {{ operation_id }} ({{ method }} {{ path }})
    """
    BASE_URL = "{{ base_url }}"
    
    @allure.title("{{ test_title }}")
    def test_{{ method_name }}(self):
        url = f"{self.BASE_URL}{{ path }}"
        headers = {
            "Authorization": "Bearer {{ access_token | default('YOUR_TOKEN') }}",
            "Content-Type": "application/json"
        }
        
        # Параметры запроса
        params = {{ params | default({}) }}
        
        # Тело запроса (для POST/PUT)
        body = {{ body | default({}) }}

        with allure.step("Arrange: Подготовка запроса"):
            # Дополнительная подготовка, если нужна
            pass

        with allure.step("Act: Выполнение запроса"):
            response = requests.{{ method.lower() }}(url, headers=headers, params=params, json=body)

        with allure.step("Assert: Проверка ответа"):
            # Проверка статуса ответа
            assert response.status_code == {{ expected_status_code | default(200) }}, \
                f"Ожидался статус {{ expected_status_code | default(200) }}, получен {response.status_code}. Ответ: {response.text}"
            
            # Дополнительные проверки тела ответа
            # {{ validation_code | default("# additional validation here") }}
            pass
